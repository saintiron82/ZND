{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saint/ZND/web/src/app/api/visitor/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\n/**\r\n * Î∞©Î¨∏Ïûê ÎßàÏùºÏä§ÌÜ§ ÏïåÎ¶º ÏãúÏä§ÌÖú\r\n * ÌïòÎ£® Î∞©Î¨∏ÏûêÍ∞Ä 10, 50, 100, 500Î™Ö ÎèÑÎã¨ Ïãú Discord ÏïåÎ¶º\r\n */\r\n\r\n// Î©îÎ™®Î¶¨ Í∏∞Î∞ò Ïπ¥Ïö¥ÌÑ∞ (ÏÑúÎ≤Ñ Ïû¨ÏãúÏûë Ïãú Î¶¨ÏÖã)\r\ninterface DailyStats {\r\n    date: string;\r\n    count: number;\r\n    notifiedMilestones: Set<number>;\r\n}\r\n\r\nlet dailyStats: DailyStats = {\r\n    date: '',\r\n    count: 0,\r\n    notifiedMilestones: new Set(),\r\n};\r\n\r\nconst MILESTONES = [10, 50, 100, 500];\r\n\r\nfunction getTodayDate(): string {\r\n    return new Date().toISOString().split('T')[0]; // YYYY-MM-DD\r\n}\r\n\r\nasync function sendMilestoneNotification(milestone: number, webhookUrl: string) {\r\n    const emojis: Record<number, string> = {\r\n        10: 'üéâ',\r\n        50: 'üî•',\r\n        100: 'üöÄ',\r\n        500: 'üèÜ',\r\n    };\r\n\r\n    const messages: Record<number, string> = {\r\n        10: 'Ï≤´ Î≤àÏß∏ ÎßàÏùºÏä§ÌÜ§! Ïò§Îäò 10Î™ÖÏù¥ Î∞©Î¨∏ÌñàÏñ¥Ïöî!',\r\n        50: 'Ï¢ãÏùÄ ÌùêÎ¶Ñ! Ïò§Îäò 50Î™ÖÏù¥ Î∞©Î¨∏ÌñàÏñ¥Ïöî!',\r\n        100: 'ÎåÄÎã®Ìï¥Ïöî! Ïò§Îäò 100Î™Ö ÎèåÌåå!',\r\n        500: 'ÎÜÄÎùºÏõåÏöî! Ïò§Îäò 500Î™ÖÏù¥ ZEDÎ•º Ï∞æÏïòÏñ¥Ïöî!',\r\n    };\r\n\r\n    const payload = {\r\n        embeds: [\r\n            {\r\n                title: `${emojis[milestone] || 'üéØ'} Î∞©Î¨∏Ïûê ${milestone}Î™Ö Îã¨ÏÑ±!`,\r\n                description: messages[milestone] || `Ïò§Îäò ${milestone}Î™ÖÏù¥ Î∞©Î¨∏ÌñàÏäµÎãàÎã§!`,\r\n                color: 0xfbbf24, // amber-400\r\n                timestamp: new Date().toISOString(),\r\n                footer: {\r\n                    text: 'ZED Visitor Milestone',\r\n                },\r\n            },\r\n        ],\r\n    };\r\n\r\n    try {\r\n        await fetch(webhookUrl, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload),\r\n        });\r\n        console.log(`[Visitor] ÎßàÏùºÏä§ÌÜ§ ${milestone}Î™Ö ÏïåÎ¶º Ï†ÑÏÜ° ÏôÑÎ£å`);\r\n    } catch (error) {\r\n        console.error(`[Visitor] ÎßàÏùºÏä§ÌÜ§ ÏïåÎ¶º Ïã§Ìå®:`, error);\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const today = getTodayDate();\r\n\r\n        // ÎÇ†ÏßúÍ∞Ä Î∞îÎÄåÎ©¥ Ïπ¥Ïö¥ÌÑ∞ Î¶¨ÏÖã\r\n        if (dailyStats.date !== today) {\r\n            dailyStats = {\r\n                date: today,\r\n                count: 0,\r\n                notifiedMilestones: new Set(),\r\n            };\r\n        }\r\n\r\n        // Î∞©Î¨∏Ïûê Ïπ¥Ïö¥Ìä∏ Ï¶ùÍ∞Ä\r\n        dailyStats.count += 1;\r\n\r\n        const webhookUrl = process.env.DISCORD_WEBHOOK_URL;\r\n\r\n        // ÎßàÏùºÏä§ÌÜ§ Ï≤¥ÌÅ¨ Î∞è ÏïåÎ¶º\r\n        if (webhookUrl) {\r\n            for (const milestone of MILESTONES) {\r\n                if (dailyStats.count >= milestone && !dailyStats.notifiedMilestones.has(milestone)) {\r\n                    dailyStats.notifiedMilestones.add(milestone);\r\n                    await sendMilestoneNotification(milestone, webhookUrl);\r\n                }\r\n            }\r\n        }\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            date: today,\r\n            count: dailyStats.count,\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('[Visitor] Ïò§Î•ò:', error);\r\n        return NextResponse.json({ error: 'ÏÑúÎ≤Ñ Ïò§Î•ò' }, { status: 500 });\r\n    }\r\n}\r\n\r\n// GET: ÌòÑÏû¨ ÌÜµÍ≥Ñ Ï°∞Ìöå (ÎîîÎ≤ÑÍ∑∏Ïö©)\r\nexport async function GET() {\r\n    return NextResponse.json({\r\n        date: dailyStats.date || getTodayDate(),\r\n        count: dailyStats.count,\r\n        milestones: MILESTONES,\r\n        notified: Array.from(dailyStats.notifiedMilestones),\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAcA,IAAI,aAAyB;IACzB,MAAM;IACN,OAAO;IACP,oBAAoB,IAAI;AAC5B;AAEA,MAAM,aAAa;IAAC;IAAI;IAAI;IAAK;CAAI;AAErC,SAAS;IACL,OAAO,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,aAAa;AAChE;AAEA,eAAe,0BAA0B,SAAiB,EAAE,UAAkB;IAC1E,MAAM,SAAiC;QACnC,IAAI;QACJ,IAAI;QACJ,KAAK;QACL,KAAK;IACT;IAEA,MAAM,WAAmC;QACrC,IAAI;QACJ,IAAI;QACJ,KAAK;QACL,KAAK;IACT;IAEA,MAAM,UAAU;QACZ,QAAQ;YACJ;gBACI,OAAO,GAAG,MAAM,CAAC,UAAU,IAAI,KAAK,KAAK,EAAE,UAAU,KAAK,CAAC;gBAC3D,aAAa,QAAQ,CAAC,UAAU,IAAI,CAAC,GAAG,EAAE,UAAU,UAAU,CAAC;gBAC/D,OAAO;gBACP,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;oBACJ,MAAM;gBACV;YACJ;SACH;IACL;IAEA,IAAI;QACA,MAAM,MAAM,YAAY;YACpB,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACzB;QACA,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,UAAU,UAAU,CAAC;IACvD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,CAAC,qBAAqB,CAAC,EAAE;IAC3C;AACJ;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,QAAQ;QAEd,iBAAiB;QACjB,IAAI,WAAW,IAAI,KAAK,OAAO;YAC3B,aAAa;gBACT,MAAM;gBACN,OAAO;gBACP,oBAAoB,IAAI;YAC5B;QACJ;QAEA,aAAa;QACb,WAAW,KAAK,IAAI;QAEpB,MAAM,aAAa,QAAQ,GAAG,CAAC,mBAAmB;QAElD,eAAe;QACf,IAAI,YAAY;YACZ,KAAK,MAAM,aAAa,WAAY;gBAChC,IAAI,WAAW,KAAK,IAAI,aAAa,CAAC,WAAW,kBAAkB,CAAC,GAAG,CAAC,YAAY;oBAChF,WAAW,kBAAkB,CAAC,GAAG,CAAC;oBAClC,MAAM,0BAA0B,WAAW;gBAC/C;YACJ;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;YACN,OAAO,WAAW,KAAK;QAC3B;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACJ;AAGO,eAAe;IAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;QACrB,MAAM,WAAW,IAAI,IAAI;QACzB,OAAO,WAAW,KAAK;QACvB,YAAY;QACZ,UAAU,MAAM,IAAI,CAAC,WAAW,kBAAkB;IACtD;AACJ"}}]
}