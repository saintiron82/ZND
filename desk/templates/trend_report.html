<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZND Desk - ì£¼ê°„ ë¦¬í¬íŠ¸</title>
    <link rel="stylesheet" href="/static/css/desk.css?v=20241231">
    <style>
        .report-layout {
            display: flex;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 60px);
        }

        /* ì‚¬ì´ë“œë°” - ë¦¬í¬íŠ¸ ëª©ë¡ */
        .report-sidebar {
            width: 280px;
            flex-shrink: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .report-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .report-item {
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: default;
            border: 1px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .report-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--accent-color);
        }

        .report-item .date-range {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .report-item .meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* ë©”ì¸ ì˜ì—­ */
        .report-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
        }

        .section-card h3 {
            margin: 0 0 1rem 0;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .prompt-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .prompt-controls select {
            padding: 0.4rem 0.8rem;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
        }

        .prompt-area {
            width: 100%;
            min-height: 200px;
            background: #1e1e1e;
            color: #a4b0be;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .result-area {
            width: 100%;
            min-height: 150px;
            background: #2d3436;
            color: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .btn-row {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .trend-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .trend-rank {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .trend-topic {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0.3rem 0;
        }

        .trend-tags {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            margin: 0.3rem 0;
        }

        .trend-tag {
            background: var(--accent-color);
            color: white;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.75rem;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
            border-left: 4px solid var(--accent-color);
            padding: 0.75rem;
            margin-top: 0.75rem;
            border-radius: 0 6px 6px 0;
        }

        .status-msg {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        .status-msg.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-msg.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .new-report-btn {
            width: 100%;
            padding: 0.6rem;
            background: var(--accent-color);
        }

        /* í”„ë¡¬í”„íŠ¸ í†µê³„ */
        .prompt-stats {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
    </style>
</head>

<body class="env-{{ znd_env }}">
    <!-- Navigation -->
    <nav class="nav-tabs">
        <a href="/board" class="tab">ğŸ“‹ ë³´ë“œ</a>
        <a href="/publisher" class="tab">ğŸ“¢ ë°œí–‰</a>
        <a href="/trend-report" class="tab active">ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸</a>
        <span id="version-badge" class="version-badge" title="ë°°í¬ ë²„ì „">...</span>
    </nav>

    <!-- Main Layout -->
    <div class="report-layout">
        <!-- ì‚¬ì´ë“œë°”: ë¦¬í¬íŠ¸ ëª©ë¡ -->
        <div class="report-sidebar">
            <div class="sidebar-header">
                <h3>ğŸ“š ë¦¬í¬íŠ¸ ëª©ë¡</h3>
            </div>
            <div style="padding: 0.5rem;">
                <button class="btn new-report-btn" onclick="newReport()">â• ìƒˆ ë¦¬í¬íŠ¸</button>
            </div>
            <div id="report-list" class="report-list">
                <p style="color: #888; text-align: center; padding: 1rem;">ë¡œë”© ì¤‘...</p>
            </div>
        </div>

        <!-- ë©”ì¸: í¸ì§‘ ì˜ì—­ -->
        <div class="report-main">
            <!-- í”„ë¡¬í”„íŠ¸ ìƒì„± -->
            <div class="section-card">
                <h3>ğŸ“‹ 1. í”„ë¡¬í”„íŠ¸ ìƒì„±</h3>
                <div id="prompt-status"
                    style="padding: 0.5rem; margin-bottom: 0.5rem; background: rgba(99,102,241,0.1); border-radius: 4px; font-size: 0.9rem; display: none;">
                </div>
                <div class="prompt-controls">
                    <label>ì‹œì‘ì¼:</label>
                    <input type="date" id="start-date"
                        style="padding: 0.4rem; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                    <label>ì¢…ë£Œì¼:</label>
                    <input type="date" id="end-date"
                        style="padding: 0.4rem; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);">
                    <button class="btn btn-primary" id="btn-generate" onclick="generatePrompt()">ğŸ“ ìƒì„±</button>
                    <button class="btn btn-secondary" onclick="copyPrompt()">ğŸ“‹ ë³µì‚¬</button>
                    <a href="https://gemini.google.com/" target="_blank" class="btn">ğŸ”— Gemini</a>
                </div>
                <textarea id="prompt-text" class="prompt-area" readonly
                    placeholder="ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  'ìƒì„±' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”..."></textarea>
                <div id="prompt-stats" class="prompt-stats"></div>
            </div>

            <!-- ê²°ê³¼ ì…ë ¥ -->
            <div class="section-card">
                <h3>ğŸ“ 2. ë¶„ì„ ê²°ê³¼ ì…ë ¥</h3>
                <textarea id="result-json" class="result-area" placeholder='LLM ê²°ê³¼ JSONì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...'></textarea>
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="saveReport()">ğŸ’¾ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="previewReport()">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
                </div>
                <div id="save-status"></div>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° -->
            <div id="preview-section" class="section-card" style="display: none;">
                <h3>ğŸ“Š 3. ë¯¸ë¦¬ë³´ê¸°</h3>
                <div id="preview-content"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/constants.js?v=20241231"></script>
    <script src="/static/js/desk-common.js?v=20241231"></script>
    <script>
        let currentPromptData = null;
        let currentReportId = null;

        // ìƒˆ ë¦¬í¬íŠ¸
        function newReport() {
            currentReportId = null;
            document.getElementById('result-json').value = '';
            document.getElementById('preview-section').style.display = 'none';
            document.getElementById('save-status').innerHTML = '';

            // ì‚¬ì´ë“œë°”ì—ì„œ active ì œê±°
            document.querySelectorAll('.report-item').forEach(el => el.classList.remove('active'));

            // UI ìƒíƒœ: ìƒˆ ë¦¬í¬íŠ¸ ëª¨ë“œ
            setPromptMode('new');
            generatePrompt();
        }

        // í”„ë¡¬í”„íŠ¸ ëª¨ë“œ ì„¤ì • (new / loaded)
        function setPromptMode(mode, period = null) {
            const statusDiv = document.getElementById('prompt-status');
            const btnGenerate = document.getElementById('btn-generate');
            const promptArea = document.getElementById('prompt-text');

            if (mode === 'loaded' && period) {
                statusDiv.innerHTML = `ğŸ“ ì €ì¥ëœ ë¦¬í¬íŠ¸ (${period.start} ~ ${period.end}). íƒœê·¸ ë°ì´í„°ë¥¼ ê°±ì‹ í•˜ë ¤ë©´ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`;
                statusDiv.style.display = 'block';

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                btnGenerate.textContent = 'ğŸ”„ ì¬ìƒì„±';

                // ë‚ ì§œ ì…ë ¥ì°½ì— ê¸°ê°„ ì„¤ì •
                document.getElementById('start-date').value = period.start;
                document.getElementById('end-date').value = period.end;

                // í”„ë¡¬í”„íŠ¸ ì˜ì—­: ë¡œë“œ ìƒíƒœ ì•ˆë‚´
                promptArea.value = '';
                promptArea.placeholder = 'ì €ì¥ëœ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤. [ğŸ”„ ì¬ìƒì„±] ë²„íŠ¼ìœ¼ë¡œ íƒœê·¸ ë°ì´í„°ë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            } else {
                statusDiv.style.display = 'none';

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³µì›
                btnGenerate.textContent = 'ğŸ“ ìƒì„±';

                // í”„ë¡¬í”„íŠ¸ ì˜ì—­: ìƒˆ ë¦¬í¬íŠ¸ ì•ˆë‚´
                promptArea.placeholder = "ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  'ìƒì„±' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”...";
            }
        }

        // ì¬ìƒì„± (ë¡œë“œëœ ë¦¬í¬íŠ¸ì˜ ë‚ ì§œë¡œ í”„ë¡¬í”„íŠ¸ ì¬ìƒì„±)
        async function regeneratePrompt() {
            await generatePrompt();
        }

        // í”„ë¡¬í”„íŠ¸ ìƒì„±
        async function generatePrompt() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const promptArea = document.getElementById('prompt-text');
            const statsArea = document.getElementById('prompt-stats');

            if (!startDate || !endDate) {
                promptArea.value = 'ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”.';
                return;
            }

            promptArea.value = 'ìƒì„± ì¤‘...';
            statsArea.innerHTML = '';

            try {
                const response = await fetch(`/api/trend-reporter/generate-prompt?start=${startDate}&end=${endDate}`);
                const data = await response.json();

                if (data.success) {
                    currentPromptData = data;
                    promptArea.value = data.prompt_text;
                    statsArea.innerHTML = `ğŸ“Š ê¸°ì‚¬ ${data.article_count}ê°œ | íšŒì°¨ ${data.edition_count}ê°œ | ${data.period.start} ~ ${data.period.end}`;

                    // íƒœê·¸ í†µê³„ ì¦‰ì‹œ í‘œì‹œ (ë°ì´í„° êµ¬ì¶• í™•ì¸ìš©)
                    renderPreview({});
                    document.getElementById('preview-section').style.display = 'block';

                    // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                    const statusDiv = document.getElementById('prompt-status');
                    statusDiv.innerHTML = 'âœ… í”„ë¡¬í”„íŠ¸ ë° íƒœê·¸ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    statusDiv.style.display = 'block';
                } else {
                    promptArea.value = 'ì˜¤ë¥˜: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (e) {
                promptArea.value = 'ì˜¤ë¥˜: ' + e.message;
            }
        }

        // í”„ë¡¬í”„íŠ¸ ë³µì‚¬
        function copyPrompt() {
            const text = document.getElementById('prompt-text').value;
            navigator.clipboard.writeText(text);
            alert('í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë¯¸ë¦¬ë³´ê¸°
        function previewReport() {
            const jsonText = document.getElementById('result-json').value.trim();
            if (!jsonText) {
                alert('JSON ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            try {
                const data = JSON.parse(jsonText);
                renderPreview(data);
                document.getElementById('preview-section').style.display = 'block';
            } catch (e) {
                alert('JSON íŒŒì‹± ì˜¤ë¥˜: ' + e.message);
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
        function renderPreview(data) {
            const container = document.getElementById('preview-content');
            let html = '';

            if (data.top_trends && data.top_trends.length > 0) {
                html += '<h4>ğŸ”¥ TOP íŠ¸ë Œë“œ</h4>';
                for (const trend of data.top_trends) {
                    html += `
                        <div class="trend-item">
                            <span class="trend-rank">#${trend.rank}</span>
                            <div class="trend-topic">${trend.topic}</div>
                            <div class="trend-tags">
                                ${(trend.tags || []).map(t => `<span class="trend-tag">${t}</span>`).join('')}
                            </div>
                            <p style="color: #ccc; font-size: 0.85rem; margin: 0.3rem 0;">${trend.summary || ''}</p>
                            ${trend.key_players ? `<p style="color: #888; font-size: 0.8rem; margin: 0;">ğŸ‘¥ ${trend.key_players.join(', ')}</p>` : ''}
                        </div>
                    `;
                }
            }

            if (data.weekly_insight) {
                html += `<div class="insight-box"><strong>ğŸ’¡ ì£¼ê°„ ì¸ì‚¬ì´íŠ¸</strong><p style="margin: 0.5rem 0 0;">${data.weekly_insight}</p></div>`;
            }

            if (data.next_week_outlook) {
                html += `<div class="insight-box" style="border-left-color: #10b981;"><strong>ğŸ”® ë‹¤ìŒ ì£¼ ì „ë§</strong><p style="margin: 0.5rem 0 0;">${data.next_week_outlook}</p></div>`;
            }

            // íƒœê·¸ ìˆœìœ„ (ì „ì²´)
            let tagRankings = data.tag_rankings;
            console.log('[DEBUG] tag_rankings:', tagRankings);
            console.log('[DEBUG] tag_stats:', JSON.stringify(data.tag_stats));
            console.log('[DEBUG] tag_stats keys:', Object.keys(data.tag_stats || {}));

            // ì €ì¥ëœ ìˆœìœ„ê°€ ì—†ê±°ë‚˜ ë¹ˆ ë°°ì—´ì´ë©´ tag_statsì—ì„œ ê³„ì‚°
            if ((!tagRankings || tagRankings.length === 0) && (data.tag_stats || currentPromptData?.tag_stats)) {
                const stats = data.tag_stats || currentPromptData.tag_stats;
                tagRankings = Object.entries(stats)
                    .sort((a, b) => b[1] - a[1])
                    .map((item, index) => ({ rank: index + 1, tag: item[0], count: item[1] }));
                console.log('[DEBUG] Calculated tagRankings from stats:', tagRankings.length);
            }


            if (tagRankings && tagRankings.length > 0) {
                html += `<h4 style="margin-top: 1.5rem;">ğŸ“ˆ íƒœê·¸ íŠ¸ë Œë“œ (ì „ì²´ ${tagRankings.length}ê°œ)</h4>`;
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.5rem; max-height: 300px; overflow-y: auto; padding-right: 5px;">';
                for (const item of tagRankings) {
                    html += `
                        <div style="background: rgba(255,255,255,0.03); padding: 0.5rem; border-radius: 4px; display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-weight: bold; color: var(--text-secondary); margin-right: 5px; min-width: 25px;">${item.rank}.</span>
                            <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${item.tag}">${item.tag}</span>
                            <span style="background: var(--bg-hover); padding: 2px 6px; border-radius: 10px; font-size: 0.8rem;">${item.count}</span>
                        </div>
                    `;
                }
                html += '</div>';
            }

            container.innerHTML = html || '<p style="color: #888;">ë°ì´í„° ìˆìŒ</p>';
        }

        // ë¦¬í¬íŠ¸ ì €ì¥
        async function saveReport() {
            const jsonText = document.getElementById('result-json').value.trim();
            const statusDiv = document.getElementById('save-status');

            if (!jsonText) {
                statusDiv.innerHTML = '<div class="status-msg error">JSON ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            try {
                const reportData = JSON.parse(jsonText);

                // ê¸°ê°„ ì •ë³´ ì¶”ê°€
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                reportData.period = currentPromptData?.period || {
                    start: startDate,
                    end: endDate
                };

                // íƒœê·¸ í†µê³„ ì¶”ê°€ (ì£¼ê°„ ìˆœìœ„ ì¶”ì ìš©)
                if (currentPromptData?.tag_stats) {
                    reportData.tag_stats = currentPromptData.tag_stats;
                }

                const response = await fetch('/api/trend-reporter/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reportData)
                });

                const result = await response.json();

                if (result.success) {
                    statusDiv.innerHTML = `<div class="status-msg success">âœ… ì €ì¥ ì™„ë£Œ! (${result.report_id})</div>`;
                    currentReportId = result.report_id;
                    loadReportList();
                } else {
                    statusDiv.innerHTML = `<div class="status-msg error">âŒ ì €ì¥ ì‹¤íŒ¨: ${result.error}</div>`;
                }
            } catch (e) {
                statusDiv.innerHTML = `<div class="status-msg error">âŒ ì˜¤ë¥˜: ${e.message}</div>`;
            }
        }

        // ë¦¬í¬íŠ¸ ëª©ë¡ ë¡œë“œ
        async function loadReportList() {
            try {
                const response = await fetch('/api/trend-reporter/list');
                const data = await response.json();
                const container = document.getElementById('report-list');

                if (data.success && data.reports && data.reports.length > 0) {
                    let html = '';
                    for (const report of data.reports) {
                        const isActive = currentReportId === report.id ? 'active' : '';
                        html += `
                            <div class="report-item ${isActive}">
                                <div onclick="loadReport('${report.id}')" style="cursor: pointer; flex: 1;">
                                    <div class="date-range">ğŸ“Š ${report.period?.start || '?'} ~ ${report.period?.end || '?'}</div>
                                    <div class="meta">${report.created_at?.slice(0, 10) || ''} ìƒì„±</div>
                                </div>
                                <button onclick="deleteReport('${report.id}', event)" style="background: rgba(239,68,68,0.2); color: #ef4444; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                            </div>
                        `;
                    }
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p style="color: #888; text-align: center; padding: 1rem;">ì €ì¥ëœ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (e) {
                console.error('Failed to load reports:', e);
            }
        }

        // ë¦¬í¬íŠ¸ ë¡œë“œ
        async function loadReport(reportId) {
            try {
                const response = await fetch(`/api/trend-reporter/get/${reportId}`);
                const data = await response.json();

                if (data.success && data.report) {
                    currentReportId = reportId;
                    document.getElementById('result-json').value = JSON.stringify(data.report, null, 2);
                    renderPreview(data.report);
                    document.getElementById('preview-section').style.display = 'block';
                    document.getElementById('save-status').innerHTML = '';

                    // UI ìƒíƒœ: ë¡œë“œëœ ë¦¬í¬íŠ¸ ëª¨ë“œ
                    setPromptMode('loaded', data.report.period);

                    // ì‚¬ì´ë“œë°” ëª©ë¡ ê°±ì‹  (Active í‘œì‹œ)
                    loadReportList();
                }
            } catch (e) {
                alert('ë¦¬í¬íŠ¸ ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        // ë¦¬í¬íŠ¸ ì‚­ì œ
        async function deleteReport(reportId, event) {
            event.stopPropagation();  // í´ë¦­ ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€

            if (!confirm(`ë¦¬í¬íŠ¸ "${reportId}"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/trend-reporter/delete/${reportId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    alert('ì‚­ì œ ì™„ë£Œ!');
                    if (currentReportId === reportId) {
                        currentReportId = null;
                        document.getElementById('result-json').value = '';
                        document.getElementById('preview-section').style.display = 'none';
                    }
                    loadReportList();
                } else {
                    alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
                }
            } catch (e) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì˜¤ëŠ˜ ~ 7ì¼ ì „)
            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);

            document.getElementById('end-date').value = today.toISOString().slice(0, 10);
            document.getElementById('start-date').value = weekAgo.toISOString().slice(0, 10);

            loadReportList();
            fetch('/api/version').then(r => r.json()).then(d => {
                document.getElementById('version-badge').textContent = d.commit_short || 'dev';
            }).catch(() => { });
        });
    </script>
</body>

</html>